"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_toUpper=_interopRequireDefault(require("lodash/toUpper")),_isFunction=_interopRequireDefault(require("lodash/isFunction")),middlewareAction=function(t,e){var r=(0,_slicedToArray2.default)(e.actions,3),a=r[0],s=r[1],u=r[2],o=e.callback,i=function(e){if(!e.hasOwnProperty("status")||!e.hasOwnProperty("result"))throw"Получен объект с неверной структурой | {status, result}";if("ok"===e.status)return t.dispatch({type:(0,_toUpper.default)(s),data:e.result}),e.hasOwnProperty("msg")&&t.dispatch({type:(0,_toUpper.default)(u),data:e.msg}),t.dispatch({type:(0,_toUpper.default)(a),data:"ok"}),(0,_isFunction.default)(o)&&o(e),e.result;if("error"!==e.status)throw"Получен не поддерживаемый статус: '".concat(e.status,"'");if((0,_isFunction.default)(o)&&o(e),e.hasOwnProperty("msg"))throw e.msg;t.dispatch({type:(0,_toUpper.default)(a),data:"error"})};if(t.dispatch({type:(0,_toUpper.default)(a),data:"wait"}),"Promise"===e.result.constructor.name)e.result.then(function(t){var e=null;if(t.hasOwnProperty("request")&&t.request instanceof XMLHttpRequest)e=t.data;else{if(!t.hasOwnProperty("status")||!t.hasOwnProperty("result"))throw"Promise вернул объект с неверной структурой";e=t}return i(e)}).catch(function(e){t.dispatch({type:(0,_toUpper.default)(a),data:"error"}),t.dispatch({type:(0,_toUpper.default)(u),data:e})});else try{return i(e.result)}catch(e){t.dispatch({type:(0,_toUpper.default)(a),data:"error"}),t.dispatch({type:(0,_toUpper.default)(u),data:e})}return!0},_default=middlewareAction;exports.default=_default;