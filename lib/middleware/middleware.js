"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_toUpper=_interopRequireDefault(require("lodash/toUpper")),_isFunction=_interopRequireDefault(require("lodash/isFunction")),middlewareAction=function(e,t){var r=t.callback,a=(0,_slicedToArray2.default)(t.actions,3),o=a[0],u=a[1],s=a[2],i=function(t,a){if(!Object.prototype.hasOwnProperty.call(t,"status")||!Object.prototype.hasOwnProperty.call(t,"result"))throw new Error("Получен объект с неверной структурой | {status, result}");if("ok"===t.status)a({type:(0,_toUpper.default)(u),data:t.result}),Object.prototype.hasOwnProperty.call(t,"msg")&&""!==t.msg&&a({type:(0,_toUpper.default)(s),data:t.msg}),e.dispatch({type:(0,_toUpper.default)(o),data:"ok"}),(0,_isFunction.default)(r)&&r(t);else{if("error"!==t.status)throw new Error("Получен не поддерживаемый статус: '".concat(t.status,"'"));if((0,_isFunction.default)(r)&&r(t),Object.prototype.hasOwnProperty.call(t,"msg")&&""!==t.msg)throw t.msg;a({type:(0,_toUpper.default)(o),data:"error"})}};if(e.dispatch({type:(0,_toUpper.default)(o),data:"wait"}),"Promise"===t.result.constructor.name)e.dispatch(function(){var e=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(r){var a,o;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.result;case 2:a=e.sent,o=a.data,i(o,r);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());else try{e.dispatch(function(e){i(t.result,e)})}catch(t){e.dispatch({type:(0,_toUpper.default)(o),data:"error"}),e.dispatch({type:(0,_toUpper.default)(s),data:t})}},_default=middlewareAction;exports.default=_default;